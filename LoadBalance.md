## 负载均衡
### What?
	负载均衡(Load Balance)，其含义就是指将负载（工作任务）进行平衡、分摊到多个操作单元上进行运行，
	例如FTP服务器、Web服务器、企业核心应用服务器和其它主要任务服务器等，从而协同完成工作任务。

### 分类
* 服务端负载均衡（平常所说的负载均衡）
	* 硬件负载均衡: 硬件负载均衡主要通过在服务器节点之间安装专门用于负载均衡的设备，常见的如F5。
	* 软件负载均衡: 软件负载均衡则是在服务器上安装一些具有负载均衡功能的软件来完成请求分发进而实现负载均衡，常见的有Nginx、Apache、LVS。
* 客户端负载均衡
	相比较服务器负载均衡而言，客户端负载均衡是一个比较小众的概念，它是在spring-cloud分布式框架组件Ribbon中定义的。

### 常见的负载均衡算法
* 随机，通过随机选择服务进行执行，一般这种方式使用较少;
* 轮训，负载均衡默认实现方式，请求来之后排队处理;
* 加权轮训，通过对服务器性能的分型，给高配置，低负载的服务器分配更高的权重，均衡各个服务器的压力;
* 地址Hash，通过客户端请求的地址的HASH值取模映射进行服务器调度。
* 最小链接数;即使请求均衡了，压力不一定会均衡，最小连接数法就是根据服务器的情况，比如请求积压数等参数，将请求分配到当前压力最小的服务器上。
* 其他若干方式

### Why?
1. 项目初期: 由于用户量少，请求和并发小，单Tomcat部署即可
2. 过渡阶段: 随着业务的发展，用户量增多，
			请求和并发量逐渐达到单台Tomcat瓶颈（假设300并发），导致请求响应时间变长，偶尔可能会出现无响应的现象，
			为提升用户体验和保证系统的可用性，决定采用集群部署
3. 简单集群: 采用多Tomcat部署，通过一个负载均衡软件（如Nginx），将请求分发到多台Tomcat服务器上，缩短请求响应时间，提升用户提验
![演示图](https://img-blog.csdn.net/20170908114755607?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMjcwMjU0Nw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

4. 复杂集群: 公司发展越来越好，用户量剧增，请求和并发量逐渐达到单台Nginx瓶颈（假设5w并发），请求响应时间再次变长，
			采用LVS/F5+Nginx集群部署，用LVS/F5对Nginx进行负载均衡，
			如果请求并发达到单台LVS瓶颈（假设50w并发），可采用DNS负载均衡+LVS/F5+Nginx进行部署，对LVS/F5在进行一层负载均衡
![演示图](https://images2018.cnblogs.com/blog/1020536/201807/1020536-20180704121836906-165220622.png)

### How?
#### 基于DNS的负载均衡
	DNS负载均衡技术是最早的负载均衡解决方案，实现原理是在DNS服务器中为同一个服务主机名配置多个IP地址，
	在应答DNS查询时，DNS服务器对每个查询将以DNS文件中主机记录的IP地址按顺序返回不同的解析结果，将客户端的访问引导到不同的机器上去，
	因此，对于同一个服务名字，不同的客户机会得到不同的地址，它们也就访问不同地址上的Web服务器，从而达到负载均衡的目的。
![演示图](https://img-blog.csdn.net/20140721145326171?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3l3b3Nw/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

#### 基于四层交换技术的负载均衡
    基于四层交换技术的负载均衡是通过报文中的目标地址和端口，再加上负载均衡设备设置的服务器选择方式，
	决定最终选择的内部服务器与请求客户端建立TCP连接，然后发送Client请求的数据。
	client发送请求至4层负载均衡器，4层负载均衡器根据负载策略把client发送的报文目标地址修改为后端服务器IP地址，
	这样client就可以直接跟后端服务器建立TCP连接并发送数据
![演示图](https://images2018.cnblogs.com/blog/1020536/201807/1020536-20180704121655803-2035673535.png)
代表产品：LVS（开源软件），F5（硬件）

#### 基于七层交换技术的负载均衡
	基于七层交换技术的负载均衡也称内容交换，也就是主要通过报文中的真正有意义的应用层内容，
	再加上负载均衡设备设置的服务器选择方式，决定最终选择的服务器。
	七层负载均衡服务器起了一个代理服务器的作用，client要访问webserver要先与七层负载设备进行三次握手后建立TCP连接，
	把要访问的报文信息发送给七层负载均衡；然后七层负载均衡再根据设置的均衡规则选择特定的webserver，
	然后通过三次握手与此台webserver建立TCP连接，然后webserver把需要的数据发送给七层负载均衡设备，负载均衡设备再把数据发送给client。
![演示图](https://images2018.cnblogs.com/blog/1020536/201807/1020536-20180704121714922-1390221287.png)
代表产品：nginx（软件）、apache（软件）
